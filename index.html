<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devamsızlık Öğrenme</title>
    <link rel="icon" href="data:,">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f0f4ff 0%, #e4ecff 100%);
            min-height: 100vh;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        h1 {
            color: #1a237e;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.6em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            line-height: 1.4;
        }
        .form-group {
            margin-bottom: 20px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        label {
            display: block;
            margin-bottom: 6px;
            color: #3949ab;
            font-weight: 500;
            font-size: 0.9em;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e8eaf6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #fafbff;
            height: 40px;
            box-sizing: border-box;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1);
        }
        button {
            background: linear-gradient(45deg, #1976d2 0%, #2196f3 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            max-width: 400px;
            display: block;
            margin: 0 auto;
            height: 40px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
            background: linear-gradient(45deg, #1565c0 0%, #1976d2 100%);
        }
        select:hover, input:hover {
            border-color: #90caf9;
        }
        ::placeholder {
            color: #90a4ae;
            font-size: 14px;
        }
        .devamsizlik-container {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            border: 2px solid #e3e9ff;
        }
        .devamsizlik-bilgi {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .devamsizlik-kutu {
            flex: 1;
            padding: 15px;
            margin: 0 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }
        .devamsizlik-kutu h3 {
            color: #1a237e;
            margin: 0 0 10px 0;
            font-size: 1em;
        }
        .devamsizlik-deger {
            font-size: 1.8em;
            color: #1976d2;
            font-weight: bold;
        }
        .devamsizlik-kutu.sinir-asildi {
            border: 2px solid #ff1744;
            background-color: #fff5f5;
        }
        .devamsizlik-kutu.sinir-asildi h3,
        .devamsizlik-kutu.sinir-asildi .devamsizlik-deger {
            color: #ff1744;
        }
        .uyari-mesaji {
            color: #ff1744;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            font-size: 1.1em;
            padding: 10px;
            background-color: #fff5f5;
            border-radius: 8px;
            border: 1px solid #ff1744;
            display: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>KAVLAKLI MESLEKİ EĞİTİM MERKEZİ<br>Devamsızlık Öğrenme</h1>
        
        <div class="form-group">
            <label for="ogrenci">Öğrenci Adı Soyadı:</label>
            <select id="ogrenci" name="ogrenci">
                <option value="">Seçiniz...</option>
            </select>
        </div>

        <div class="form-group">
            <label for="tcno">TC Kimlik No:</label>
            <input type="text" id="tcno" name="tcno" maxlength="11" placeholder="TC Kimlik Numaranızı Giriniz">
        </div>

        <button onclick="girisYap()">Giriş Yap</button>

        <div id="devamsizlikBilgileri" class="devamsizlik-container">
            <div class="devamsizlik-bilgi">
                <div class="devamsizlik-kutu" id="okulDevamsizlikKutu">
                    <h3>OKUL DEVAMSIZLIK</h3>
                    <div id="okulDevamsizlik" class="devamsizlik-deger">-</div>
                </div>
                <div class="devamsizlik-kutu" id="isletmeDevamsizlikKutu">
                    <h3>İŞLETME DEVAMSIZLIK</h3>
                    <div id="isletmeDevamsizlik" class="devamsizlik-deger">-</div>
                </div>
            </div>
            <div id="devamsizlikUyari" class="uyari-mesaji"></div>
            <div id="isletmeDevamsizlikUyari" class="uyari-mesaji"></div>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '1ruaq4MkTQsYDyiBC2LYn9_G0DnXIc0dBOlMI9lKTPT8';
        let ogrenciVerileri = []; // Tüm öğrenci verilerini tutacak dizi
        
        // Öğrenci verilerini yükle
        async function loadStudentData() {
            try {
                // Ad Soyad, TC No ve devamsızlık verilerini al
                const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sayfa1&range=C2:J1000`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Veri alınamadı');
                }
                
                const data = await response.text();
                const rows = data.split('\n');
                
                const selectElement = document.getElementById('ogrenci');
                
                // Mevcut seçenekleri temizle (ilk option hariç)
                while (selectElement.options.length > 1) {
                    selectElement.remove(1);
                }

                // Verileri işle
                rows.forEach((row, index) => {
                    const values = row.split(',').map(item => {
                        // Tırnak işaretlerini ve boşlukları temizle
                        const cleanValue = item.replace(/"/g, '').trim();
                        // Nokta ile gelen ondalık sayıyı virgüle çevir
                        return cleanValue.replace('.', ',');
                    });
                    const [tcNo, adSoyad, , , , okulDevamsizlik, , isletmeDevamsizlik] = values;
                    
                    if (tcNo && adSoyad && tcNo !== 'null' && adSoyad !== 'null') {
                        ogrenciVerileri.push({ 
                            tcNo, 
                            adSoyad, 
                            index,
                            okulDevamsizlik: okulDevamsizlik || '0',
                            isletmeDevamsizlik: isletmeDevamsizlik || '0'
                        });
                        
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = adSoyad;
                        selectElement.appendChild(option);
                    }
                });

                // Öğrencileri alfabetik sıraya diz
                const options = Array.from(selectElement.options).slice(1);
                options.sort((a, b) => a.text.localeCompare(b.text, 'tr', {sensitivity: 'base'}));
                
                // Sıralanmış öğrencileri tekrar ekle
                while (selectElement.options.length > 1) {
                    selectElement.remove(1);
                }
                options.forEach(option => selectElement.add(option));

                console.log(`Toplam ${options.length} öğrenci yüklendi.`);
                
            } catch (error) {
                console.error('Veri yükleme hatası:', error);
                alert('Öğrenci listesi yüklenirken bir hata oluştu!');
            }
        }

        // TC Kimlik No kontrolü
        function tcKimlikKontrol(tcno) {
            if (tcno.length !== 11) return false;
            if (!(/^[0-9]+$/.test(tcno))) return false;
            return true;
        }

        // Devamsızlık bilgilerini göster
        function devamsizlikGoster(ogrenci) {
            const devamsizlikDiv = document.getElementById('devamsizlikBilgileri');
            const okulDevamsizlikDiv = document.getElementById('okulDevamsizlik');
            const isletmeDevamsizlikDiv = document.getElementById('isletmeDevamsizlik');
            const okulDevamsizlikKutu = document.getElementById('okulDevamsizlikKutu');
            const isletmeDevamsizlikKutu = document.getElementById('isletmeDevamsizlikKutu');
            const devamsizlikUyari = document.getElementById('devamsizlikUyari');
            const isletmeDevamsizlikUyari = document.getElementById('isletmeDevamsizlikUyari');

            // Okul devamsızlık verisini direkt olarak göster (zaten virgüllü formatta)
            const okulDevamsizlikDeger = ogrenci.okulDevamsizlik + ' GÜN';
            const isletmeDevamsizlikDeger = ogrenci.isletmeDevamsizlik + ' GÜN';
            
            okulDevamsizlikDiv.textContent = okulDevamsizlikDeger;
            isletmeDevamsizlikDiv.textContent = isletmeDevamsizlikDeger;

            // Devamsızlık sınırı kontrolü (6 gün)
            const okulDevamsizlikSayi = parseFloat(ogrenci.okulDevamsizlik.replace(',', '.'));
            if (okulDevamsizlikSayi > 6) {
                okulDevamsizlikKutu.classList.add('sinir-asildi');
                devamsizlikUyari.textContent = 'OKUL DEVAMSIZLIK SINIRI AŞILMIŞ. SINIF TEKRARI.';
                devamsizlikUyari.style.display = 'block';
            } else {
                okulDevamsizlikKutu.classList.remove('sinir-asildi');
                devamsizlikUyari.style.display = 'none';
            }

            // İşletme devamsızlık sınırı kontrolü (30 gün)
            const isletmeDevamsizlikSayi = parseFloat(ogrenci.isletmeDevamsizlik.replace(',', '.'));
            if (isletmeDevamsizlikSayi > 30) {
                isletmeDevamsizlikKutu.classList.add('sinir-asildi');
                isletmeDevamsizlikUyari.textContent = 'İŞLETME DEVAMSIZLIK SINIRI AŞILMIŞ. SINIF TEKRARI.';
                isletmeDevamsizlikUyari.style.display = 'block';
            } else {
                isletmeDevamsizlikKutu.classList.remove('sinir-asildi');
                isletmeDevamsizlikUyari.style.display = 'none';
            }

            devamsizlikDiv.style.display = 'block';
        }

        // Sayfa yüklendiğinde verileri yükle
        window.onload = loadStudentData;

        function girisYap() {
            const ogrenciIndex = document.getElementById('ogrenci').value;
            const girilenTcno = document.getElementById('tcno').value;

            if (!ogrenciIndex || !girilenTcno) {
                alert('Lütfen tüm alanları doldurunuz!');
                return;
            }

            if (!tcKimlikKontrol(girilenTcno)) {
                alert('Geçerli bir TC Kimlik Numarası giriniz!');
                return;
            }

            // Seçilen öğrencinin verilerini bul
            const secilenOgrenci = ogrenciVerileri.find(ogrenci => ogrenci.index.toString() === ogrenciIndex);
            
            if (!secilenOgrenci) {
                alert('Öğrenci bilgisi bulunamadı!');
                return;
            }

            // TC No eşleşmesini kontrol et
            if (secilenOgrenci.tcNo === girilenTcno) {
                alert(`Giriş başarılı! Hoş geldiniz ${secilenOgrenci.adSoyad}`);
                devamsizlikGoster(secilenOgrenci);
            } else {
                alert('TC Kimlik Numarası ile öğrenci bilgileri eşleşmiyor!');
                document.getElementById('devamsizlikBilgileri').style.display = 'none';
            }
        }
    </script>
</body>
</html> 